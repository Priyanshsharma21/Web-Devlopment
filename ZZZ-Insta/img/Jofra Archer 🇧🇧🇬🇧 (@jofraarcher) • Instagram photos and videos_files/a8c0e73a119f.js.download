__d(function(g,r,i,a,m,e,d){"use strict";function t(t,c){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var T=Object.getOwnPropertySymbols(t);c&&(T=T.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),n.push.apply(n,T)}return n}function c(c){for(var n=1;n<arguments.length;n++){var T=null!=arguments[n]?arguments[n]:{};n%2?t(T,!0).forEach(function(t){i(d[0])(c,t,T[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(c,Object.getOwnPropertyDescriptors(T)):t(T).forEach(function(t){Object.defineProperty(c,t,Object.getOwnPropertyDescriptor(T,t))})}return c}Object.defineProperty(e,'__esModule',{value:!0});var n=20,T=(function(){function t(t,T){var s=this;this.$DirectMQTT11=function(t){var c,T=i(d[1])(s.$DirectMQTT2);try{c=JSON.parse(t)}catch(t){return void s.$DirectMQTT1.logError("Could not parse mqttMessages",t)}Array.isArray(c)?i(d[2])(i(d[3])(c,n),function(t){r(d[4]).batch(function(){var c=!0,n=!1,o=void 0;try{for(var u,D=t[Symbol.iterator]();!(c=(u=D.next()).done);c=!0){var l=u.value,M=l.data,Q=l.event,_=l.mutation_token,$=l.seq_id;if(s.$DirectMQTT1.debugTrace('parsed_message',{event:Q,mutation_token:_}),'patch'!==Q)return void s.$DirectMQTT1.debugTrace('skipped_message',{event:Q});if(!Array.isArray(M))return void s.$DirectMQTT1.debugTrace('parsed_message_bad_operations',typeof M);var b=!0,h=!1,p=void 0;try{for(var v,y=M[Symbol.iterator]();!(b=(v=y.next()).done);b=!0){var f=v.value;T.handleDelta(f,_)}}catch(t){h=!0,p=t}finally{try{b||null==y.return||y.return()}finally{if(h)throw p}}if($){var E=s.$DirectMQTT3.subscription_type;s.$DirectMQTT1.debugTrace('seq_id',{seq_id:$,subscriptionType:E}),'message'===E&&T.onSeqIdUpdated($)}}}catch(t){n=!0,o=t}finally{try{c||null==D.return||D.return()}finally{if(n)throw o}}})}):s.$DirectMQTT1.debugTrace('parsed_message_not_array',typeof c)},this.$DirectMQTT12=function(t){try{var c=JSON.parse(t);if('ok'===c.status){var n;null==(null===c||void 0===c?void 0:null===(n=c.payload)||void 0===n?void 0:n.activity_status)?s.$DirectMQTT1.logDirectEvent('send_message_response_success'):s.$DirectMQTT1.logDirectEvent('send_activity_response_success')}else{var T;null==(null===c||void 0===c?void 0:null===(T=c.payload)||void 0===T?void 0:T.activity_status)?s.$DirectMQTT1.logError('send_message_response_failed'):s.$DirectMQTT1.logDirectEvent('send_activity_response_failed')}}catch(t){s.$DirectMQTT1.logError('send_message_response_parse_failed',t)}},this.$DirectMQTT13=function(t){s.$DirectMQTT1.debugTrace('state_changed',t);var c=i(d[1])(s.$DirectMQTT2);if('Connected'===t){var n=i(d[1])(s.$DirectMQTT5);n.subscribe('/ig_message_sync',s.$DirectMQTT11),n.subscribe('/ig_send_message_response',s.$DirectMQTT12),s.$DirectMQTT4||(s.$DirectMQTT4=new(r(d[5]).DirectIrisSubscription)(c,s.$DirectMQTT3,n,s.$DirectMQTT1.getDebugId())),s.$DirectMQTT4.subscribe(),s.$DirectMQTT7||(s.$DirectMQTT7=new(r(d[6]).DirectGraphQLSubscription)(c,n,s.$DirectMQTT1.getDebugId())),'message'===s.$DirectMQTT3.subscription_type?(s.$DirectMQTT6||(s.$DirectMQTT6=new(r(d[7]).DirectSkywalkerSubscription)(c,n,s.$DirectMQTT1.getDebugId())),s.$DirectMQTT6.subscribe(),s.$DirectMQTT7&&s.$DirectMQTT7.enableOrDisableEventHandlerByType(r(d[8]).GRAPH_QL_EVENT_TYPES.PRESENCE,!0)):(s.$DirectMQTT1.debugTrace('skip_skywalker',s.$DirectMQTT3),s.$DirectMQTT7&&s.$DirectMQTT7.enableOrDisableEventHandlerByType(r(d[8]).GRAPH_QL_EVENT_TYPES.PRESENCE,!1)),s.$DirectMQTT7&&s.$DirectMQTT7.subscribe()}else if('Disconnected'===t){s.$DirectMQTT4&&(s.$DirectMQTT4.unsubscribe(),s.$DirectMQTT4=null),s.$DirectMQTT6&&(s.$DirectMQTT6.unsubscribe(),s.$DirectMQTT6=null),s.$DirectMQTT7&&(s.$DirectMQTT7.unsubscribeGraphQL(),s.$DirectMQTT7=null);var T=s.$DirectMQTT5;T&&(T.unsubscribe('/ig_message_sync'),T.unsubscribe('/ig_send_message_response'))}c.onMqttConnectivityChanged(t)},this.$DirectMQTT14=function(t){return s.$DirectMQTT1.logDirectEvent('send_attempt',{action:t.action,type:t.item_type||''}),i(d[1])(s.$DirectMQTT5).publish('/ig_send_message',JSON.stringify(c({client_context:i(d[9])(),device_id:s.$DirectMQTT10()},t))).catch(function(t){throw s.$DirectMQTT1.logError('send_message_failed',t),t})},this.$DirectMQTT1=new(r(d[10]).DirectLogger)('DirectMQTT',T),this.$DirectMQTT1.debugTrace('ctor',t),this.$DirectMQTT2=null,this.$DirectMQTT3=t,this.$DirectMQTT4=null,this.$DirectMQTT5=null,this.$DirectMQTT6=null,this.$DirectMQTT7=null}var T=t.prototype;return T.$DirectMQTT8=function(){return parseInt(i(d[1])(r(d[11]).getViewerId()),10)},T.$DirectMQTT9=function(){return parseInt(r(d[11]).getIGAppID(),10)},T.$DirectMQTT10=function(){return r(d[12]).getDeviceOrMachineId()},T.sendTextMessage=function(t,c,n,T,s){return this.$DirectMQTT14({action:'send_item',item_type:r(d[13]).ThreadItemType.TEXT,mutation_token:n,replied_to_item_id:T,replied_to_client_context:s,text:c,thread_id:t})},T.sendMediaShare=function(t,c){return this.$DirectMQTT14({action:'send_item',item_type:r(d[13]).ThreadItemType.MEDIA_SHARE,media_id:c,thread_id:t})},T.sendLike=function(t,c){return this.$DirectMQTT14({action:'send_item',item_type:r(d[13]).ThreadItemType.LIKE,mutation_token:c,thread_id:t})},T.indicateTypingActivity=function(t,c){return this.$DirectMQTT14({action:'indicate_activity',thread_id:c,activity_status:t})},T.markVisualItemSeen=function(t,c){return this.$DirectMQTT14({action:'mark_visual_item_seen',target_item_type:'voice_media',thread_id:c,item_ids:JSON.stringify([t])})},T.modifyLikeReaction=function(t,c,n,T,s){var o;return this.$DirectMQTT14({action:'send_item',item_id:t,item_type:'reaction',node_type:'item',reaction_status:T,reaction_type:'like',target_item_type:c,thread_id:n,emoji:null!==(o=s)&&void 0!==o?o:''})},T.disconnect=function(){this.$DirectMQTT1.debugTrace('disconnect_start'),this.$DirectMQTT4?(this.$DirectMQTT1.debugTrace('unsubscribe_iris'),i(d[1])(this.$DirectMQTT4).unsubscribe(),this.$DirectMQTT4=null):this.$DirectMQTT1.debugTrace('no_iris'),this.$DirectMQTT6?(this.$DirectMQTT1.debugTrace('unsubscribe_skywalker'),this.$DirectMQTT6=null):this.$DirectMQTT1.debugTrace('no_skywalker'),this.$DirectMQTT7?(this.$DirectMQTT1.debugTrace('unsubscribe_graphql'),this.$DirectMQTT7=null):this.$DirectMQTT1.debugTrace('no_graphql'),this.$DirectMQTT5?(this.$DirectMQTT1.debugTrace('shutdown_channel'),i(d[1])(this.$DirectMQTT5).shutdown(),this.$DirectMQTT5=null):this.$DirectMQTT1.debugTrace('no_channel'),this.$DirectMQTT2&&(this.$DirectMQTT2=null),this.$DirectMQTT1.debugTrace('disconnect_end')},T.connect=function(t){var c=this;this.$DirectMQTT1.debugTrace('connect_start'),this.disconnect(),this.$DirectMQTT2=new(r(d[14]).DirectDeltaHandlers)(t,this.$DirectMQTT1.getDebugId());var n={onMQTTStateChanged:this.$DirectMQTT13,onJSError:function(t){c.$DirectMQTT1.logError("mqtt_js_error",t)}},T={appSpecificInfo:{},deviceId:this.$DirectMQTT10()},s=r(d[11]).getLanguageCode();null!=s&&(T.appSpecificInfo['Accept-Language']=s),i(d[15]).initialize();var o={endpoint:r(d[13]).PROD_MQTT_GATEWAY,userFbid:this.$DirectMQTT8(),appId:this.$DirectMQTT9(),initialSubscribedTopics:[],igSpecificOptions:T,observer:n,debugId:this.$DirectMQTT1.getDebugId(),capabilities:0,clientCapabilities:1,chatVisibility:!0};this.$DirectMQTT5=new(i(d[16]))(o),this.$DirectMQTT1.debugTrace('connect_end')},T.subscribeToLiveEvent=function(t,c,n){var T=this.$DirectMQTT7;if(null!=T){var s=new(i(d[17]))(c);T.enableLiveEventHandler(t,s,n),T.subscribe()}},T.unsubscribeToLiveEvent=function(t){var c=this.$DirectMQTT7;null!=c&&(c.disableLiveEventHandler(t),c.subscribe())},T.getLogger=function(){return this.$DirectMQTT1},t})();e.DirectMQTT=T},3604480,[13500417,13565981,3604481,3604483,5,3604484,3604486,3604494,3604487,13500701,13500542,13500423,13500515,13500698,13501105,3604495,3604499,3604510]);
__d(function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,'__esModule',{value:!0}),e.default=function(t,n){return new Promise(function(u,c){function o(){try{n(t[f])}catch(t){return void c(t)}++f>=t.length?u():i(d[0])(o)}var f=0;0!==t.length?o():u()})}},3604481,[3604482]);
__d(function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,'__esModule',{value:!0});var t=process&&'function'==typeof process.nextTick?function(t){process.nextTick(t)}:'function'==typeof setImmediate?function(t){setImmediate(t)}:'function'==typeof setTimeout?function(t){setTimeout(t,0)}:function(t){t()};e.default=t},3604482,[]);
__d(function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,'__esModule',{value:!0}),e.default=function(t,u){for(var n=[],c=0;c<t.length;c+=u)n.push(t.slice(c,c+u));return n}},3604483,[]);
__d(function(g,r,i,a,m,e,d){"use strict";function t(t,s){var c=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);s&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),c.push.apply(c,n)}return c}function s(s){for(var c=1;c<arguments.length;c++){var n=null!=arguments[c]?arguments[c]:{};c%2?t(n,!0).forEach(function(t){i(d[0])(s,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(n)):t(n).forEach(function(t){Object.defineProperty(s,t,Object.getOwnPropertyDescriptor(n,t))})}return s}Object.defineProperty(e,'__esModule',{value:!0});var c=1,n=2,o=1e3,u=64e3,b=(function(){function t(t,b,p,D){var I=this;this.$DirectIrisSubscription6=function(){I.$DirectIrisSubscription1.logDirectClientEvent('ig_direct_iris_subscription',r(d[1]).DIRECT_CONTAINER_MODULES.ig_direct_realtime,s({},I.$DirectIrisSubscription3,{action:'attempt',attempt_reason:'mqtt-connected'})),I.$DirectIrisSubscription2.onIrisConnectivityChanged('Subscribing');var t=JSON.stringify(I.$DirectIrisSubscription3);I.$DirectIrisSubscription4.publish('/ig_sub_iris',t).catch(function(t){I.$DirectIrisSubscription1.logDirectClientEvent('ig_direct_iris_subscription',r(d[1]).DIRECT_CONTAINER_MODULES.ig_direct_realtime,s({},I.$DirectIrisSubscription3,{action:'error',error:JSON.stringify(t)})),I.$DirectIrisSubscription2.onIrisConnectivityChanged('Unsubscribed')})},this.$DirectIrisSubscription7=function(t){var o;if(i(d[2])(t))try{o=JSON.parse(t)}catch(t){var b="Could not parse sub iris response $(response)";I.$DirectIrisSubscription1.logError(b,t),i(d[3])(b),o=t}else i(d[4])(t)?o=t:(i(d[3])("Unknown sub iris response $(response)"),o={succeeded:!1});if(!0===o.succeeded)I.$DirectIrisSubscription1.logDirectClientEvent('ig_direct_iris_subscription',r(d[1]).DIRECT_CONTAINER_MODULES.ig_direct_realtime,s({},I.$DirectIrisSubscription3,{action:'success'})),I.$DirectIrisSubscription2.onIrisConnectivityChanged('Subscribed',I.$DirectIrisSubscription3.subscription_type);else if(I.$DirectIrisSubscription1.logDirectClientEvent('ig_direct_iris_subscription',r(d[1]).DIRECT_CONTAINER_MODULES.ig_direct_realtime,s({},I.$DirectIrisSubscription3,{},o,{action:'error'})),I.$DirectIrisSubscription2.onIrisConnectivityChanged('Unsubscribed'),o.error_type===c)I.$DirectIrisSubscription2.onResnapshotRequested(I.$DirectIrisSubscription3);else if(o.error_type===n){var p=I.$DirectIrisSubscription5+Math.floor(1e3*Math.random());setTimeout(I.$DirectIrisSubscription6,p),I.$DirectIrisSubscription5=Math.min(2*I.$DirectIrisSubscription5,u)}},this.$DirectIrisSubscription1=new(r(d[1]).DirectLogger)('DirectIrisSubscription',D),this.$DirectIrisSubscription1.debugTrace('ctor',b),this.$DirectIrisSubscription2=t,this.$DirectIrisSubscription3=b,this.$DirectIrisSubscription4=p,this.$DirectIrisSubscription5=o}var b=t.prototype;return b.subscribe=function(){this.$DirectIrisSubscription1.debugTrace('subscribe_start'),this.unsubscribe(),this.$DirectIrisSubscription4.subscribe('/ig_sub_iris_response',this.$DirectIrisSubscription7),this.$DirectIrisSubscription6(),this.$DirectIrisSubscription1.debugTrace('subscribe_end')},b.unsubscribe=function(){this.$DirectIrisSubscription1.debugTrace('unsubscribe_start'),this.$DirectIrisSubscription8&&(clearTimeout(this.$DirectIrisSubscription8),this.$DirectIrisSubscription8=null),this.$DirectIrisSubscription4.unsubscribe('/ig_sub_iris_response'),this.$DirectIrisSubscription2.onIrisConnectivityChanged('Unsubscribed'),this.$DirectIrisSubscription1.debugTrace('unsubscribe_end')},t})();e.DirectIrisSubscription=b},3604484,[13500417,13500542,3604485,13500517,13500440]);
__d(function(g,r,i,a,m,e,d){var t='[object String]';m.exports=function(n){return'string'==typeof n||!r(d[0])(n)&&r(d[1])(n)&&r(d[2])(n)==t}},3604485,[13500571,13500433,13500434]);
__d(function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,'__esModule',{value:!0});var t='/ig_realtime_sub',n=(function(n){function s(s,E,c){var u,_=new(r(d[1]).DirectLogger)('DirectGraphQLSubscription',c);return u=n.call(this,t,[],E,_)||this,u.$DirectGraphQLSubscription1=_,u.$DirectGraphQLSubscription2=s,u.$DirectGraphQLSubscription3=new Map,u.$DirectGraphQLSubscription4(),u.getSubTopics(),u}i(d[0])(s,n);var E=s.prototype;return E.$DirectGraphQLSubscription4=function(){for(var t=0,n=Object.keys(r(d[2]).GRAPH_QL_EVENT_TYPES);t<n.length;t++){var s=n[t];r(d[2]).GRAPH_QL_EVENT_TYPES[s]===r(d[2]).GRAPH_QL_EVENT_TYPES.PRESENCE||r(d[2]).GRAPH_QL_EVENT_TYPES[s]===r(d[2]).GRAPH_QL_EVENT_TYPES.WAVE||r(d[2]).GRAPH_QL_EVENT_TYPES[s]===r(d[2]).GRAPH_QL_EVENT_TYPES.PINNED_QUESTION||this.$DirectGraphQLSubscription5(r(d[2]).GRAPH_QL_EVENT_TYPES[s])||this.$DirectGraphQLSubscription1.debugTrace('invalid_handler_type')}},E.getSubTopics=function(){var t=[],n=!0,s=!1,E=void 0;try{for(var c,u=this.$DirectGraphQLSubscription3[Symbol.iterator]();!(n=(c=u.next()).done);n=!0){var _=i(d[3])(c.value,2),p=(_[0],_[1].getSubTopic());null!=p&&''!==p&&t.push(p)}}catch(t){s=!0,E=t}finally{try{n||null==u.return||u.return()}finally{if(s)throw E}}return this.updateSubTopics(t),t},E.processMessage=function(t){var s=!0,E=!1,c=void 0;try{for(var u,_=this.$DirectGraphQLSubscription3[Symbol.iterator]();!(s=(u=_.next()).done);s=!0){var p=i(d[3])(u.value,2);p[0];p[1].processEventMessage(t)}}catch(t){E=!0,c=t}finally{try{s||null==_.return||_.return()}finally{if(E)throw c}}n.prototype.processMessage.call(this,t)},E.enableOrDisableEventHandlerByType=function(t,n){return n?this.$DirectGraphQLSubscription5(t)||this.$DirectGraphQLSubscription1.debugTrace('invalid_handler_type'):this.$DirectGraphQLSubscription3.delete(t),this},E.$DirectGraphQLSubscription5=function(t){this.$DirectGraphQLSubscription3||(this.$DirectGraphQLSubscription3=new Map);var n=this.$DirectGraphQLSubscription6(t);return null!=n&&(this.$DirectGraphQLSubscription3.set(t,n),!0)},E.$DirectGraphQLSubscription6=function(t){switch(t){case r(d[2]).GRAPH_QL_EVENT_TYPES.PRESENCE:return new(r(d[4]).PresenceGraphQLEventHandler)(this.$DirectGraphQLSubscription2,this.$DirectGraphQLSubscription1.getDebugId());case r(d[2]).GRAPH_QL_EVENT_TYPES.BD_CHALLENGE:return new(r(d[5]).BdChallengeGraphQLEventHandler)(this.$DirectGraphQLSubscription1.getDebugId());default:return null}},E.enableLiveEventHandler=function(t,n,s){switch(s){case r(d[2]).GRAPH_QL_EVENT_TYPES.WAVE:return this.$DirectGraphQLSubscription3.set(r(d[2]).GRAPH_QL_EVENT_TYPES.WAVE,new(r(d[6]).WaveGraphQLEventHandler)(n,t)),this;case r(d[2]).GRAPH_QL_EVENT_TYPES.PINNED_QUESTION:return this.$DirectGraphQLSubscription3.set(r(d[2]).GRAPH_QL_EVENT_TYPES.PINNED_QUESTION,new(r(d[7]).PinnedQuestionGraphQLEventHandler)(n,t)),this;case r(d[2]).GRAPH_QL_EVENT_TYPES.QUESTION_STATUS:return this.$DirectGraphQLSubscription3.set(r(d[2]).GRAPH_QL_EVENT_TYPES.QUESTION_STATUS,new(r(d[8]).QuestionStatusGraphQLEventHandler)(n,t)),this;default:return this}},E.disableLiveEventHandler=function(t){switch(t){case r(d[2]).GRAPH_QL_EVENT_TYPES.WAVE:return this.$DirectGraphQLSubscription3.delete(r(d[2]).GRAPH_QL_EVENT_TYPES.WAVE),this;case r(d[2]).GRAPH_QL_EVENT_TYPES.PINNED_QUESTION:return this.$DirectGraphQLSubscription3.delete(r(d[2]).GRAPH_QL_EVENT_TYPES.PINNED_QUESTION),this;case r(d[2]).GRAPH_QL_EVENT_TYPES.QUESTION_STATUS:return this.$DirectGraphQLSubscription3.delete(r(d[2]).GRAPH_QL_EVENT_TYPES.QUESTION_STATUS),this;default:return this}},E.unsubscribeGraphQL=function(){this.unsubscribe(),this.enableOrDisableEventHandlerByType(r(d[2]).GRAPH_QL_EVENT_TYPES.PRESENCE,!1),this.enableOrDisableEventHandlerByType(r(d[2]).GRAPH_QL_EVENT_TYPES.WAVE,!1)},s})(r(d[9]).DirectBaseSubscription);e.DirectGraphQLSubscription=n},3604486,[13500500,13500542,3604487,67,3604488,3604489,3604490,3604491,3604492,3604493]);
__d(function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,'__esModule',{value:!0});var n=Object.freeze({PRESENCE:'Presence',BD_CHALLENGE:'BdChallenge',WAVE:'Wave',PINNED_QUESTION:'PinnedQuestion',QUESTION_STATUS:'QuestionStatus',NONE:''}),t=(function(){function t(){}var u=t.prototype;return u.processEventMessage=function(n){},u.getSubTopic=function(){return null},u.getGraphQLSubsciptionPrefix=function(){return"1/graphqlsubscriptions/"},u.getType=function(){return n.NONE},t})();e.GRAPH_QL_EVENT_TYPES=n,e.BaseGraphQLEventHandler=t},3604487,[]);
__d(function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,'__esModule',{value:!0});var n='17846944882223835',t=r(d[0]).GRAPH_QL_EVENT_TYPES.PRESENCE,s=(function(s){function c(t,c){var p;return p=s.call(this)||this,p.$PresenceGraphQLEventHandler1=new(r(d[2]).DirectLogger)('PresenceGraphQLEventHandler',c),p.$PresenceGraphQLEventHandler2=t,p.$PresenceGraphQLEventHandler1.debugTrace('presence_gql_handler_init'),p.$PresenceGraphQLEventHandler3=p.getGraphQLSubsciptionPrefix()+n+'/'+JSON.stringify({input_data:{client_subscription_id:i(d[3])()}}),p}i(d[1])(c,s);var p=c.prototype;return p.processEventMessage=function(n){var t=n.presence_event;null!=t?this.$PresenceGraphQLEventHandler2.onPresenceUpdated(t):this.$PresenceGraphQLEventHandler1.debugTrace('parsed_message_bad_data')},p.getSubTopic=function(){return this.$PresenceGraphQLEventHandler3},p.getType=function(){return t},c})(r(d[0]).BaseGraphQLEventHandler);e.PresenceGraphQLEventHandler=s},3604488,[3604487,13500500,13500542,13565982]);
__d(function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,'__esModule',{value:!0});var n='17935802131473058',t=r(d[0]).GRAPH_QL_EVENT_TYPES.BD_CHALLENGE,l=(function(l){function h(t){var h;return h=l.call(this)||this,h.$BdChallengeGraphQLEventHandler1=new(r(d[2]).DirectLogger)('BDChallengeGraphQLEventHandler',t),h.$BdChallengeGraphQLEventHandler1.debugTrace('bd_challenge_gql_handler_init'),h.$BdChallengeGraphQLEventHandler2=h.getGraphQLSubsciptionPrefix()+n+'/'+JSON.stringify({input_data:{client_subscription_id:i(d[3])()}}),h}i(d[1])(h,l);var c=h.prototype;return c.processEventMessage=function(n){var t=n.bd_challenge_event;null!=t?r(d[5])(d[4],"BDClientSignalCollectionTrigger").then(function(n){n.BDClientSignalCollectionTrigger.handleBdChallenge(t)}):this.$BdChallengeGraphQLEventHandler1.debugTrace('parsed_message_bad_data')},c.getSubTopic=function(){return this.$BdChallengeGraphQLEventHandler2},c.getType=function(){return t},h})(r(d[0]).BaseGraphQLEventHandler);e.BdChallengeGraphQLEventHandler=l},3604489,[3604487,13500500,13500542,13565982,3538944,66]);
__d(function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,'__esModule',{value:!0});var t='17882305414154951',n=r(d[0]).GRAPH_QL_EVENT_TYPES.WAVE,v=(function(v){function _(n,_){var s;return s=v.call(this)||this,s.$WaveGraphQLEventHandler1=n,s.$WaveGraphQLEventHandler2=s.getGraphQLSubsciptionPrefix()+t+'/'+JSON.stringify({input_data:{client_subscription_id:i(d[2])(),receiver_id:r(d[3]).getViewerId(),broadcast_id:String(_.id)},publish_data:{broadcast_id:String(_.id),receiver_id:r(d[3]).getViewerId(),waver_id:String(_.broadcast_owner)}}),s}i(d[1])(_,v);var s=_.prototype;return s.processEventMessage=function(t){var n=t.live_video_wave_event;if(null!=n){var v={type:"LIVE_WAVE",wave:n};this.$WaveGraphQLEventHandler1.eventHandler(v)}},s.getSubTopic=function(){return this.$WaveGraphQLEventHandler2},s.getType=function(){return n},_})(r(d[0]).BaseGraphQLEventHandler);e.WaveGraphQLEventHandler=v},3604490,[3604487,13500500,13565982,13500423]);
__d(function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,'__esModule',{value:!0});var n='18005526940184517',t=r(d[0]).GRAPH_QL_EVENT_TYPES.PINNED_QUESTION,u=(function(u){function s(t,s){var o;return o=u.call(this)||this,o.$PinnedQuestionGraphQLEventHandler1=t,o.$PinnedQuestionGraphQLEventHandler2=o.getGraphQLSubsciptionPrefix()+n+'/'+JSON.stringify({input_data:{client_subscription_id:i(d[2])(),broadcast_id:String(s.id)}}),o}i(d[1])(s,u);var o=s.prototype;return o.processEventMessage=function(n){var t=n.live_active_question_event;if(null!=t){var u={question:t,type:"PINNED_QUESTION"};this.$PinnedQuestionGraphQLEventHandler1.eventHandler(u)}},o.getSubTopic=function(){return this.$PinnedQuestionGraphQLEventHandler2},o.getType=function(){return t},s})(r(d[0]).BaseGraphQLEventHandler);e.PinnedQuestionGraphQLEventHandler=u},3604491,[3604487,13500500,13565982]);
__d(function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,'__esModule',{value:!0});var t='18027779584026952',n=r(d[0]).GRAPH_QL_EVENT_TYPES.QUESTION_STATUS,s=(function(s){function u(n,u){var o;return o=s.call(this)||this,o.$QuestionStatusGraphQLEventHandler1=n,o.$QuestionStatusGraphQLEventHandler2=o.getGraphQLSubsciptionPrefix()+t+'/'+JSON.stringify({input_data:{client_subscription_id:i(d[2])(),broadcast_id:String(u.id)}}),o}i(d[1])(u,s);var o=u.prototype;return o.processEventMessage=function(t){var n=t.live_question_submission_status_event;if(null!=n){var s={status:n,type:"QUESTION_STATUS"};this.$QuestionStatusGraphQLEventHandler1.eventHandler(s)}},o.getSubTopic=function(){return this.$QuestionStatusGraphQLEventHandler2},o.getType=function(){return n},u})(r(d[0]).BaseGraphQLEventHandler);e.QuestionStatusGraphQLEventHandler=s},3604492,[3604487,13500500,13565982]);
__d(function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,'__esModule',{value:!0});var s=(function(){function s(s,t,c,u){var n=this;this.$DirectBaseSubscription5=function(s){n.$DirectBaseSubscription4.debugTrace('message_received');if(null!=n.parsePayload(s)){var t;if(0!==s.length){'\0'===s[s.length-1]?(t=s.substring(0,s.length-1),n.$DirectBaseSubscription4.debugTrace('trimmed_null_char')):t=s;var c={};try{c=JSON.parse(t)}catch(t){return void n.$DirectBaseSubscription4.logError("Cannot parse message "+s,t)}n.processMessage(c)}else n.$DirectBaseSubscription4.logError('empty_message')}},this.$DirectBaseSubscription1=s,this.$DirectBaseSubscription2=t,this.$DirectBaseSubscription3=c,this.$DirectBaseSubscription4=u,this.$DirectBaseSubscription4.debugTrace('ctor')}var t=s.prototype;return t.parsePayload=function(s){return s},t.processMessage=function(s){},t.$DirectBaseSubscription6=function(s){var t;return JSON.stringify((t={},t[s]=this.getSubTopics(),t))},t.subscribe=function(){this.getSubTopics().length<1?this.$DirectBaseSubscription4.debugTrace('no_subtopics_to_subscribe'):(this.$DirectBaseSubscription4.debugTrace('subscribe_start'),this.unsubscribe(),this.$DirectBaseSubscription3.subscribe(this.$DirectBaseSubscription1,this.$DirectBaseSubscription5),this.$DirectBaseSubscription3.publish(this.$DirectBaseSubscription1,this.$DirectBaseSubscription6('sub')),this.$DirectBaseSubscription4.debugTrace('subscribe_end'))},t.unsubscribe=function(){this.getSubTopics().length<1?this.$DirectBaseSubscription4.debugTrace('no_subtopics_to_unsubscribe'):(this.$DirectBaseSubscription4.debugTrace('unsubscribe_start'),this.$DirectBaseSubscription3.publish(this.$DirectBaseSubscription1,this.$DirectBaseSubscription6('unsub')),this.$DirectBaseSubscription3.unsubscribe(this.$DirectBaseSubscription1),this.$DirectBaseSubscription4.debugTrace('unsubscribe_end'))},t.updateSubTopics=function(s){this.$DirectBaseSubscription2=s},t.getSubTopics=function(){return this.$DirectBaseSubscription2},s})();e.DirectBaseSubscription=s},3604493,[]);
__d(function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,'__esModule',{value:!0});var t='/pubsub',s=(function(s){function c(c,n,o){var l,u=new(r(d[1]).DirectLogger)('DirectSkywalkerSubscription',o);return l=s.call(this,t,["ig/u/v1/"+i(d[2])(r(d[3]).getViewerId())],n,u)||this,l.$DirectSkywalkerSubscription1=u,l.$DirectSkywalkerSubscription2=c,l}i(d[0])(c,s);var n=c.prototype;return n.parsePayload=function(t){return-1===t.indexOf('/activity_indicator_id/')?(this.$DirectSkywalkerSubscription1.debugTrace('not_activity_indicator_message'),null):s.prototype.parsePayload.call(this,t)},n.processMessage=function(t){var c=t.data,n=t.event;if('patch'===n)if(Array.isArray(c)){var o=!0,l=!1,u=void 0;try{for(var p,y=c[Symbol.iterator]();!(o=(p=y.next()).done);o=!0){var S=p.value;this.$DirectSkywalkerSubscription2.handleDelta(S,'')}}catch(t){l=!0,u=t}finally{try{o||null==y.return||y.return()}finally{if(l)throw u}}s.prototype.processMessage.call(this,t)}else this.$DirectSkywalkerSubscription1.debugTrace('parsed_message_bad_data',typeof c);else this.$DirectSkywalkerSubscription1.debugTrace('skipped_message',{event:n})},c})(r(d[4]).DirectBaseSubscription);e.DirectSkywalkerSubscription=s},3604494,[13500500,13500542,13565981,13500423,3604493]);
__d(function(g,r,i,a,m,e,d){'use strict';var t={initialize:function(){r(d[0]).Env.initialize(null,r(d[1]).isLoggedIn,null,i(d[2]),function(){return i(d[3]).getInstance()},null,null,null,null,function(t,n){var l=i(d[4]).getLocalStorage();if(l){var u=l.getItem("mqtt:"+t);if(null!=u)return u}return n},function(t,n){var l=i(d[4]).getLocalStorage();l&&(null==n?l.removeItem("mqtt:"+t):l.setItem("mqtt:"+t,n))})}};m.exports=t},3604495,[3604496,13500423,13565978,3604497,13500503]);
__d(function(g,r,i,a,m,e,d){'use strict';var n=Object.freeze({mqtt_ep_with_sid:0,mqtt_waterfall_log_client_sampling:1,messenger_uses_mqtt_rollout:2,mqtt_ws_polling_enabled:3,mqtt_ws_forced_polling_only:4,mqtt_send_unload_event:6,mqtt_ws_reconnect_reset:7,mqtt_lp_use_fetch:9,mqtt_fast_lp:11}),t=(function(){function n(){this.$Env1=null,this.$Env2=null,this.$Env3=null,this.$Env4=null,this.$Env5=null,this.$Env6=null,this.$Env7=null,this.$Env8=null,this.$Env9=null,this.$Env10=null,this.$Env11=null}var t=n.prototype;return t.random=function(){return null!=this.$Env1?this.$Env1():Math.random()},t.isUserLoggedInNow=function(){return null==this.$Env2||this.$Env2()},t.clearTimeout=(function(n){function t(t){return n.apply(this,arguments)}return t.toString=function(){return n.toString()},t})(function(n){null==this.$Env3?clearTimeout(n):this.$Env3(n)}),t.setTimeout=(function(n){function t(t,s){return n.apply(this,arguments)}return t.toString=function(){return n.toString()},t})(function(n,t){for(var s=arguments.length,o=new Array(s>2?s-2:0),u=2;u<s;u++)o[u-2]=arguments[u];return null!=this.$Env4?this.$Env4.apply(null,arguments):setTimeout.apply(null,arguments)}),t.getLoggerInstance=function(){return null!=this.$Env5?this.$Env5():s.getInstance()},t.genGk=function(n){return null!=this.$Env6&&this.$Env6(n)},t.createSocket=function(n,t){return null!=this.$Env7?this.$Env7(n,t):new WebSocket(n)},t.scheduleCallback=function(n){return null!=this.$Env8?this.$Env8(n):n()},t.scheduleLoggingCallback=function(n){return null!=this.$Env9?this.$Env9(n):n()},t.configRead=function(n,t){return null!=this.$Env10?this.$Env10(n,t):t},t.configWrite=function(n,t){null!=this.$Env11&&this.$Env11(n,t)},t.initialize=function(n,t,s,o,u,l,c,h,v,E,f){this.$Env1=n,this.$Env2=t,this.$Env3=s,this.$Env4=o,this.$Env5=u,this.$Env6=l,this.$Env7=c,this.$Env8=h,this.$Env9=v,this.$Env10=E,this.$Env11=f},n})(),s=(function(){function n(){}n.getInstance=function(){return new n};var t=n.prototype;return t.setAppId=function(n){},t.eventLogConnect=function(n){n.sessionID,n.connectionStatus,n.duration,n.hostname,n.attemptNumber,n.failTotal,n.successTotal,n.subscribedTopics,n.publishes,n.errorCode,n.errorMessage},t.eventLogPull=function(n){n.pullEventName,n.sessionID,n.status,n.duration,n.hostname,n.errorMessage},t.eventLogDisconnect=function(n){n.sessionID,n.errorCode,n.errorMessage,n.duration},t.eventLogPublish=function(n){n.sessionID,n.topic,n.connectionStatus,n.publishStatus},t.eventLogMiscellaneousError=function(n){n.errorMessage},t.logError=function(n,t){},t.logErrorWarn=function(n,t){},t.logWarn=function(n,t){},t.debugTrace=function(n,t){},t.bumpCounter=function(n){},n})();m.exports={Env:new t,MqttGkNames:n}},3604496,[]);
__d(function(g,r,i,a,m,e,d){'use strict';var t=null,n=new(r(d[0]).DirectLogger)('mqtt_client',i(d[1]).getID()),o='mqtt_client_connect',s='mqtt_client_disconnect',c='mqtt_client_publish',u='mqtt_client_error',l=(function(){function l(){this.$MqttLogger1=0,this.$MqttLogger2=Date.now(),this.$MqttLogger3=i(d[1]).getID()}l.getInstance=function(){return t||(t=new l),t};var _=l.prototype;return _.setAppId=function(t){0===this.$MqttLogger1&&(this.$MqttLogger1=t)},_.eventLogConnect=function(t){var n=t.sessionID,s=t.connectionStatus,c=t.duration,u=t.hostname,l=t.attemptNumber,_=(t.failTotal,t.successTotal,t.subscribedTopics),h=t.publishes,v=t.errorCode,L=t.errorMessage;s?i(d[2]).incr('web.mqtt.mqtt_client_connect.success'):i(d[2]).incr('web.mqtt.mqtt_client_connect.failed');var q={device_id:this.$MqttLogger3,session_id:n,logged_in:i(d[3]).Env.isUserLoggedInNow(),href:window.location.hostname,connection_status:s,duration:c,hostname:u,attempt_number:l,subscribed_topics:_,publishes:h,error_code:v,error_message:L};this.$MqttLogger4(o,q)},_.eventLogPull=function(t){var n=t.pullEventName,o=t.sessionID,s=t.status,c=t.duration,u=t.hostname,l=t.errorMessage,_={device_id:this.$MqttLogger3,session_id:o,logged_in:i(d[3]).Env.isUserLoggedInNow(),href:window.location.hostname,connection_status:s,duration:c,hostname:u,error_message:l};this.$MqttLogger4(n,_)},_.eventLogDisconnect=function(t){var n=t.sessionID,o=t.errorCode,c=t.errorMessage,u=t.duration;i(d[2]).incr('web.mqtt.mqtt_client_disconnect');var l={device_id:this.$MqttLogger3,session_id:n,href:window.location.hostname,duration:u,error_code:o,error_message:c};this.$MqttLogger4(s,l)},_.eventLogPublish=function(t){var n=t.sessionID,o=t.topic,s=t.connectionStatus,u=t.publishStatus;i(d[2]).incr('web.mqtt.mqtt_client_publish');var l={device_id:this.$MqttLogger3,href:window.location.hostname,session_id:n,topic:o,connection_status:s,publish_status:u};this.$MqttLogger4(c,l)},_.logError=function(t,o){i(d[3]).Env.scheduleLoggingCallback(function(){n.logError(o,t)})},_.eventLogMiscellaneousError=function(t){var n=t.errorMessage,o={device_id:this.$MqttLogger3,logged_in:i(d[3]).Env.isUserLoggedInNow(),href:window.location.hostname,error_message:n,time_passed:Date.now()-this.$MqttLogger2};this.$MqttLogger4(u,o)},_.logErrorWarn=function(t,o){i(d[3]).Env.scheduleLoggingCallback(function(){n.logError(o,t)})},_.logWarn=function(t,n){},_.debugTrace=function(t,o){i(d[3]).Env.scheduleLoggingCallback(function(){n.debugTrace(t,o)})},_.bumpCounter=function(t){},_.$MqttLogger4=function(t,o){var s=this;i(d[3]).Env.scheduleLoggingCallback(function(){o.event_type=t,o.app_id=s.$MqttLogger1,o.online=s.$MqttLogger5(),n.logDirectEvent(t,o)})},_.$MqttLogger5=function(){return!(!window.navigator||void 0===window.navigator.onLine)&&window.navigator.onLine},l})();m.exports=l},3604497,[13500542,3604498,13500510,3604496]);
__d(function(g,r,i,a,m,e,d){'use strict';var t=i(d[0])(),n={getID:function(){return t}};m.exports=n},3604498,[13565982]);
__d(function(g,r,i,a,m,e,d){'use strict';var t=(function(){function t(t){var n=this,o=t.appId,h=t.capabilities,l=t.chatVisibility,s=void 0===l||l,c=t.clientCapabilities,u=t.debugId,q=t.endpoint,C=t.igSpecificOptions,M=t.initialSubscribedTopics,$=t.observer,f=t.userFbid;this.$MqttChannel1=i(d[0]).Env.getLoggerInstance(),this.$MqttChannel1.setAppId(o),this.$MqttChannel2=new(i(d[1]))(f,h,c,i(d[2]).getID(),o,s,C),this.$MqttChannel3=q,this.$MqttChannel4='Disconnected',this.$MqttChannel5=[$],this.$MqttChannel6=new Set,this.$MqttChannel7=new Map,this.$MqttChannel8=new(i(d[3]))(C,u),C&&C.deviceId?this.$MqttChannel9=C.deviceId:this.$MqttChannel9=i(d[4])(),this.$MqttChannel10=new(i(d[5])),this.$MqttChannel8.addHook(this.$MqttChannel10),this.$MqttChannel8.addHook(new(i(d[6]))(function(){return n.$MqttChannel6.size>0})),this.$MqttChannel11=!1,this.$MqttChannel12=new Map,this.$MqttChannel13=[],this.$MqttChannel14(M)}var n=t.prototype;return n.$MqttChannel14=function(t){var n=this;if(this.$MqttChannel8.isRunning())this.$MqttChannel15('run','Connection started calling run again');else{if(i(d[0]).Env.genGk(i(d[0]).MqttGkNames.mqtt_ws_polling_enabled)){if(i(d[0]).Env.genGk(i(d[0]).MqttGkNames.mqtt_ws_forced_polling_only))return void this.$MqttChannel15('MqttChannel','Websocket disabled, will do long polling only');if(!i(d[7]).hasWSSupport())return this.$MqttChannel15('MqttChannel','Websocket Unavailable, will do long polling only'),void i(d[8]).incr('web.mqtt.ws_unavailable_polling')}this.$MqttChannel8.run({onStateChange:function(t){n.$MqttChannel16(t)},onJSError:function(t){n.$MqttChannel17(t)},onMessageReceived:function(t,o){n.$MqttChannel18(t,o)},endpoint:this.$MqttChannel3,mqttUserName:this.$MqttChannel2,subscribedTopics:t,extraConnectMessageProvider:function(){return n.$MqttChannel19()}})}},n.shutdown=function(){this.$MqttChannel8&&this.$MqttChannel8.shutdown()},n.publish=function(t,n,o){return void 0===o&&(o={qos:1,skipBuffer:!1}),0===o.qos?this.$MqttChannel20(t,n):this.$MqttChannel21(t,n,o)},n.$MqttChannel20=function(t,n){return this.$MqttChannel8.publish(t,n,0)},n.$MqttChannel21=function(t,n,o){var h={resolve:function(){},reject:function(t){}},l=new Promise(function(t,n){h.resolve=t,h.reject=n}),s=i(d[0]).Env.random(),c={topic:t,payload:n,options:o,ack:h,publishToken:s,timeoutId:null};return o.skipBuffer?'Connecting'===this.$MqttChannel8.connectionState()?this.$MqttChannel13.push(c):this.$MqttChannel22(c):(c.timeoutId=this.$MqttChannel23(s),this.$MqttChannel12.set(s,c),this.$MqttChannel24(c)),l},n.$MqttChannel22=function(t){i(d[7]).promiseDone(this.$MqttChannel8.publish(t.topic,t.payload,t.options.qos),function(){t.ack.resolve()},function(n){t.ack.reject(n)})},n.$MqttChannel24=function(t){var n=this;i(d[7]).promiseDone(this.$MqttChannel8.publish(t.topic,t.payload,t.options.qos),function(){return n.$MqttChannel25(t)},function(t){})},n.subscribe=function(t,n){this.$MqttChannel8.subscribe(t);var o=this.$MqttChannel7.get(t);o?o.push(n):(o=[n],this.$MqttChannel7.set(t,o))},n.subscribeChannelEvents=function(t){this.$MqttChannel5.push(t)},n.registerExtraConnectPayloadProvider=function(t){var n=this;if(this.$MqttChannel6.add(t),this.$MqttChannel8.isRunning()){t.getPublishMessages().forEach(function(t){n.publish(t.topic,t.payload,{qos:t.qos,skipBuffer:!0})})}},n.unregisterExtraConnectPayloadProvider=function(t){this.$MqttChannel6.delete(t)},n.unsubscribe=function(t){this.$MqttChannel8.unsubscribe(t),this.$MqttChannel7.delete(t)},n.getConnectionState=function(){return this.$MqttChannel4},n.getEndpoint=function(){return this.$MqttChannel3},n.addHook=function(t){this.$MqttChannel8.addHook(t)},n.removeHook=function(t){this.$MqttChannel8.removeHook(t)},n.testOnlyMessageReceived=function(t,n){this.$MqttChannel18(t,n)},n.$MqttChannel26=function(t){var n=this.$MqttChannel12.get(t);null!=n&&null!=n.timeoutId&&i(d[0]).Env.clearTimeout(n.timeoutId),this.$MqttChannel12.delete(t)},n.$MqttChannel23=function(t){var n=this;return i(d[0]).Env.setTimeout(function(t){var o=n.$MqttChannel12.get(t);if(o){var h=o.topic;i(d[8]).incr('web.mqtt.publish_timeout'),n.$MqttChannel1.debugTrace('publish_timeout',"Timeout publishing topic: "+h+" publishToken: "+t),n.$MqttChannel26(t),o.ack.reject(new Error('Publish Timed Out'))}},6e4,t)},n.$MqttChannel25=function(t){var n=t.publishToken;this.$MqttChannel12.get(n)&&(this.$MqttChannel26(n),t.ack.resolve(),this.$MqttChannel1.debugTrace('publish_success',"Topic: "+t.topic+" publishToken: "+t.publishToken),i(d[8]).incr('web.mqtt.publish_success'))},n.$MqttChannel18=function(t,n){var o=this.$MqttChannel7.get(t);if(o){var h=!0,l=!1,s=void 0;try{for(var c,u=o[Symbol.iterator]();!(h=(c=u.next()).done);h=!0){var q=c.value;try{q(n)}catch(t){this.$MqttChannel1.logError(t,'Listener exception'),i(d[8]).incr('web.mqtt.listener_error')}}}catch(t){l=!0,s=t}finally{try{h||null==u.return||u.return()}finally{if(l)throw s}}}else this.$MqttChannel1.debugTrace('_onMessageReceived',t+" being dropped, no listeners")},n.$MqttChannel17=function(t){i(d[0]).Env.genGk(i(d[0]).MqttGkNames.mqtt_ws_polling_enabled)?t.isRecoverable?i(d[8]).incr('web.mqtt.recoverable_error_skipped'):i(d[8]).incr('web.mqtt.unrecoverable_error_skipped'):(t.isRecoverable?i(d[8]).incr('web.mqtt.recoverable_error_not_skipped'):i(d[8]).incr('web.mqtt.unrecoverable_error_not_skipped'),t.isRecoverable||(this.$MqttChannel11=!0),this.$MqttChannel27(t))},n.$MqttChannel28=function(t){this.$MqttChannel27(t)},n.$MqttChannel27=function(t){var n=!0,o=!1,h=void 0;try{for(var l,s=this.$MqttChannel5[Symbol.iterator]();!(n=(l=s.next()).done);n=!0){var c=l.value;c.onJSError&&c.onJSError(t)}}catch(t){o=!0,h=t}finally{try{n||null==s.return||s.return()}finally{if(o)throw h}}},n.$MqttChannel16=function(t){var n=this;'Connecting'===t?(this.$MqttChannel13.forEach(function(t){t.ack.reject(new Error('Client Reconnecting'))}),this.$MqttChannel13=[]):'TransportConnected'===t&&(this.$MqttChannel13.forEach(function(t){n.$MqttChannel22(t)}),this.$MqttChannel13=[],this.$MqttChannel12.forEach(function(t,o,h){n.$MqttChannel24(t)})),this.$MqttChannel4=this.$MqttChannel29(t),this.$MqttChannel15('_changeState',"Connection state = "+t),this.$MqttChannel30()},n.$MqttChannel29=function(t){switch(t){case'Connecting':case'TransportConnected':return'Connecting';case'Connected':return'Connected';case'Disconnected':return'Disconnected'}throw new Error('Unknown state '+t)},n.$MqttChannel30=function(){var t=!0,n=!1,o=void 0;try{for(var h,l=this.$MqttChannel5[Symbol.iterator]();!(t=(h=l.next()).done);t=!0){h.value.onMQTTStateChanged(this.$MqttChannel4)}}catch(t){n=!0,o=t}finally{try{t||null==l.return||l.return()}finally{if(n)throw o}}},n.$MqttChannel19=function(){var t=this,n=[];return this.$MqttChannel6.forEach(function(o){try{var h=o.getPublishMessages();Array.prototype.push.apply(n,h)}catch(n){t.$MqttChannel1.logError(n,'ConnectPayload provider exception'),i(d[8]).incr('web.mqtt.connectPayloadProvider_error')}}),n},n.$MqttChannel15=function(t,n){this.$MqttChannel1.debugTrace(t,"Mqtt channel: "+n)},n.setForegroundState=function(t){this.$MqttChannel2&&this.$MqttChannel2.setForegroundState(t)},n.setChatVisibility=function(t){this.$MqttChannel2&&this.$MqttChannel2.setChatVisibility(t)},t})();m.exports=t},3604499,[3604496,3604500,3604498,3604501,13565982,3604508,3604509,3604503,13500510]);
__d(function(g,r,i,a,m,e,d){'use strict';var t=(function(){function t(t,s,n,o,h,c,q){this.$MqttUserName1=t,this.$MqttUserName2=s,this.$MqttUserName3=n,this.$MqttUserName4=o,this.$MqttUserName5=h,this.$MqttUserName6=c,this.$MqttUserName7=q,this.$MqttUserName8='object'==typeof document&&document&&document.hasFocus()}var s=t.prototype;return s.gen=function(t,s,n){var o={u:this.$MqttUserName1,s:t,cp:this.$MqttUserName3,ecp:this.$MqttUserName2,chat_on:this.$MqttUserName6,fg:this.$MqttUserName8,d:this.$MqttUserName4,ct:'cookie_auth',mqtt_sid:'',aid:this.$MqttUserName5,st:s,pm:n,dc:'',no_auto_fg:!0,asi:void 0,a:navigator.userAgent};return this.$MqttUserName7&&this.$MqttUserName7.appSpecificInfo&&(o.asi=this.$MqttUserName7.appSpecificInfo),JSON.stringify(o)},s.setForegroundState=function(t){this.$MqttUserName8=t},s.setChatVisibility=function(t){this.$MqttUserName6=t},t})();m.exports=t},3604500,[]);
__d(function(g,r,i,a,m,e,d){'use strict';var t=function(t){},n=(function(){function n(t,n){var o=this;this.$MqttConnection41=function(t){var n=new Set(t);n.forEach(function(t){o.$MqttConnection4.has(t)||o.unsubscribe(t)});new Set(o.$MqttConnection4).forEach(function(t){n.has(t)||o.subscribe(t)})},this.$MqttConnection38=function(t,n){try{i(d[0]).incr('web.mqtt.js_error_in_init');var c=t?t.message:'error';o.$MqttConnection2.debugTrace('onError',n+': '+c),o.$MqttConnection15(t)}catch(t){i(d[0]).incr('web.mqtt.js_error_in_error_logging'),o.$MqttConnection2.logError(t,'JS error while trying to log previous error')}},this.$MqttConnection1=!1,this.$MqttConnection2=i(d[1]).Env.getLoggerInstance(),this.$MqttConnection3='Disconnected',this.$MqttConnection4=new Set,this.$MqttConnection5=new Map,this.$MqttConnection6=0,this.$MqttConnection7=0,this.$MqttConnection8=0,this.$MqttConnection9=0,this.$MqttConnection1=!1,this.$MqttConnection10='',this.$MqttConnection11=new(i(d[2]))(0,0,1,'',0,!0),this.$MqttConnection12=0,this.$MqttConnection13=null;var c=function(){};this.$MqttConnection14=c,this.$MqttConnection15=c,this.$MqttConnection16=c,this.$MqttConnection17=new(i(d[3])),this.$MqttConnection18=function(){return[]},this.$MqttConnection19=t}var o=n.prototype;return o.run=function(n){var o=this,c=n.onStateChange,s=n.onJSError,q=n.onMessageReceived,C=n.endpoint,u=n.mqttUserName,h=n.subscribedTopics,M=n.extraConnectMessageProvider;this.$MqttConnection1?this.$MqttConnection2.debugTrace('run','Run called while in running state.'):(this.$MqttConnection14=c,this.$MqttConnection16=q,this.$MqttConnection10=C,this.$MqttConnection11=u,this.$MqttConnection1=!0,this.$MqttConnection8=0,this.$MqttConnection15=s||t,h&&h.forEach(function(t){return o.$MqttConnection4.add(t)}),this.$MqttConnection18=M,this.$MqttConnection20(),this.$MqttConnection21())},o.shutdown=function(){this.$MqttConnection22(),this.$MqttConnection23('shutdown'),this.$MqttConnection1=!1,this.$MqttConnection2.debugTrace('shutdown',"Shutdown")},o.subscribe=function(t){return this.$MqttConnection4.add(t),this.ensureConnected("subscribe")&&this.$MqttConnection24(t),!0},o.publish=function(t,n,o){var c={resolve:function(){},reject:function(t){}},s=new Promise(function(t,n){c.resolve=t,c.reject=n}),q=this.ensureConnected("publish"),C='connection_unknown';if(q){C=!0===this.$MqttConnection25(t,n,o,c)?'connection_published':'connection_failed'}else C='connection_not_connected',c.reject(new Error('Client disconnected'));return this.$MqttConnection2.eventLogPublish({sessionID:this.$MqttConnection12,topic:t,connectionStatus:q,publishStatus:C}),s},o.unsubscribe=function(t){return this.$MqttConnection4.delete(t),this.ensureConnected("unsubscribe")&&this.$MqttConnection26(t),!0},o.addHook=function(t){this.$MqttConnection17.addHook(t)},o.removeHook=function(t){this.$MqttConnection17.removeHook(t)},o.isRunning=function(){return this.$MqttConnection1},o.getSessionId=function(){return this.$MqttConnection12},o.ensureConnected=function(t){if(!this.$MqttConnection1)return this.$MqttConnection2.debugTrace('ensureConnected',"Mqtt connection: "+t+" called when not running"),!1;if(null==this.$MqttConnection13)return this.$MqttConnection2.debugTrace('ensureConnected',"Mqtt connection: "+t+" called when not connected, ignored"),!1;return!!this.$MqttConnection13.isConnected()||(this.$MqttConnection2.debugTrace('ensureConnected',"Mqtt connection: "+t+" called with client not connected"),!1)},o.connectionState=function(){return this.$MqttConnection3},o.testOnlyGetSubscribedTopics=function(){return this.$MqttConnection4},o.$MqttConnection20=function(){var t=this;i(d[1]).Env.genGk(i(d[1]).MqttGkNames.mqtt_send_unload_event)&&'undefined'!=typeof window&&window.addEventListener('unload',function(n){return t.$MqttConnection27(n)})},o.$MqttConnection27=function(t){this.publish('/browser_close','{}',0)},o.$MqttConnection22=function(){this.$MqttConnection1&&null!=this.$MqttConnection13&&(this.$MqttConnection28('Disconnected'),null!=this.$MqttConnection13&&this.$MqttConnection13.disconnect(),this.$MqttConnection13=null)},o.$MqttConnection28=function(t){t!==this.$MqttConnection3&&(this.$MqttConnection3=t,this.$MqttConnection14(t))},o.$MqttConnection21=function(){var t=this;if(this.$MqttConnection1){this.$MqttConnection28('Connecting');var n=Date.now();this.$MqttConnection12=i(d[4]).generateSessionId();var o=Array.from(this.$MqttConnection4),c=i(d[4]).endpointWithSessionId(this.$MqttConnection10,this.$MqttConnection12);try{this.$MqttConnection13=new(i(d[5]))(c);var s=this.$MqttConnection29(),q=s.map(function(t){return t.topic}),C=this.$MqttConnection11.gen(this.$MqttConnection12,o,s);null!=this.$MqttConnection13&&(this.$MqttConnection13.connect({userName:C,mqttVersion:3,keepAliveInterval:10,ignoreSubProtocol:!0,onConnectFailure:function(c){return t.$MqttConnection30(c,n,o,q)},onConnectSuccess:function(){return t.$MqttConnection31(n,o,q)},onConnection:function(){return t.$MqttConnection32(s,o)},onConnectionError:function(n){return t.$MqttConnection33(n)},onConnectionLost:function(n){return t.$MqttConnection34(n)},onMessageArrived:function(n,o){return t.$MqttConnection35(n,o)},onMessageDelivered:function(n,o){return t.$MqttConnection36(n,o)}}),i(d[0]).incr('web.mqtt.protocol.connectattempt'),this.$MqttConnection17.onConnectAttempt())}catch(t){i(d[0]).incr('web.mqtt.js_error_in_init_exception'),this.$MqttConnection28('Disconnected'),this.$MqttConnection37(!1,n,o,[],14,t.message),t&&this.$MqttConnection2.logErrorWarn(t,'ws_js_error'),this.$MqttConnection17.onWSFatal(),this.$MqttConnection38(new(i(d[6]).MqttChannelError)(!1,'ws_js_error',t),'client_init')}}},o.$MqttConnection29=function(){var t=65536;return this.$MqttConnection18().map(function(n){return n.messageId=t--,n})},o.$MqttConnection24=function(t){try{if(null!=this.$MqttConnection13)return this.$MqttConnection13.subscribe(t),this.$MqttConnection2.debugTrace('_doSubscribe',"Subscribing to "+t),this.$MqttConnection17.onSubscribe(t),i(d[0]).incr('web.mqtt.protocol.subscribe'),!0}catch(t){this.$MqttConnection2.logError(t,'Exception subscribing'),i(d[0]).incr('web.mqtt.subscribe_exception'),i(d[0]).incr('web.mqtt.protocol.subscribe.error')}return!1},o.$MqttConnection26=function(t){try{if(null!=this.$MqttConnection13)return this.$MqttConnection13.unsubscribe(t),this.$MqttConnection2.debugTrace('_doUnsubscribe',"Unsubscribing to "+t),this.$MqttConnection17.onUnsubscribe(t),i(d[0]).incr('web.mqtt.protocol.unsubscribe'),!0}catch(t){this.$MqttConnection2.logError(t,'Exception unsubscribing'),i(d[0]).incr('web.mqtt.unsubscribe_exception'),i(d[0]).incr('web.mqtt.protocol.unsubscribe.error')}return!1},o.$MqttConnection25=function(t,n,o,c){if(null==this.$MqttConnection13)return!1;try{var s=this.$MqttConnection13.publish(t,n,o);i(d[0]).incr('web.mqtt.protocol.publish');var q=null!=s?s:'null';return this.$MqttConnection2.debugTrace('_doPublish',"publish "+t+" with messageId:"+q+" qos:"+o),this.$MqttConnection17.onPublish(t),null!=s?this.$MqttConnection5.set(s,c):c.resolve(),!0}catch(t){return this.$MqttConnection2.logError(t,'Exception publishing'),i(d[0]).incr('web.mqtt.publish_exception'),c.reject(t),i(d[0]).incr('web.mqtt.protocol.publish.error'),!1}},o.$MqttConnection39=function(t){var n=this;if(void 0===t&&(t=null),this.$MqttConnection1){this.$MqttConnection22(),this.$MqttConnection23('reconnect'),this.$MqttConnection40(),this.$MqttConnection12=-1,this.$MqttConnection9=0;var o=null!=t?t:Math.pow(2,Math.min(this.$MqttConnection8,6))*(1e3+200*i(d[1]).Env.random());this.$MqttConnection2.debugTrace('_scheduleReconnect',"Reconnect in "+o+" ms"),i(d[1]).Env.setTimeout(function(){n.$MqttConnection21()},o),this.$MqttConnection8+=1}},o.$MqttConnection40=function(){if(i(d[1]).Env.genGk(i(d[1]).MqttGkNames.mqtt_ws_reconnect_reset)){var t=Date.now()-this.$MqttConnection9,n=0!==this.$MqttConnection9&&t>5e3,o=this.$MqttConnection8>15;(n||o)&&(this.$MqttConnection8=0),0!==this.$MqttConnection9&&t<=5e3&&i(d[0]).incr('web.mqtt.short_lived_session'),o&&i(d[0]).incr('web.mqtt.connection_attempt_limit')}},o.$MqttConnection37=function(t,n,o,c,s,q){!0===t?this.$MqttConnection7++:this.$MqttConnection6++,this.$MqttConnection2.eventLogConnect({sessionID:this.$MqttConnection12,connectionStatus:t,duration:Date.now()-n,hostname:this.$MqttConnection10,attemptNumber:this.$MqttConnection8,failTotal:this.$MqttConnection6,successTotal:this.$MqttConnection7,subscribedTopics:o,publishes:c,errorCode:s,errorMessage:q})},o.$MqttConnection30=function(t,n,o,c){var s=t.mqttError,q=s.errorMessage;this.$MqttConnection2.debugTrace('connect',"Connect failed "+q),i(d[0]).incr('web.mqtt.protocol.onconnectfailure'),this.$MqttConnection17.onConnectFailure(),this.$MqttConnection37(!1,n,o,c,s.errorCode,q),null==t.connAck||(i(d[0]).incr('web.mqtt.protocol.connect_failure'),21!==t.connAck)?this.$MqttConnection39():this.$MqttConnection39(18e4)},o.$MqttConnection32=function(t,n){var o=this;i(d[0]).incr('web.mqtt.protocol.onconnection'),this.$MqttConnection2.debugTrace('Connect','Socket established'),this.$MqttConnection17.onConnected(),n.forEach(function(t){o.$MqttConnection17.onSubscribe(t)}),t.forEach(function(t){o.$MqttConnection17.onPublish(t.topic)}),this.$MqttConnection28('TransportConnected')},o.$MqttConnection31=function(t,n,o){i(d[0]).incr('web.mqtt.protocol.onconnectsuccess'),this.$MqttConnection2.debugTrace('connect','Connect success'),this.$MqttConnection17.onConnectSuccess(),this.$MqttConnection37(!0,t,n,o),this.$MqttConnection28('Connected'),this.$MqttConnection41(n),i(d[1]).Env.genGk(i(d[1]).MqttGkNames.mqtt_ws_reconnect_reset)||(this.$MqttConnection8=0),this.$MqttConnection9=Date.now()},o.$MqttConnection34=function(t){i(d[0]).incr('web.mqtt.protocol.onconnectionlost'),t.errorCode&&this.$MqttConnection2.eventLogDisconnect({sessionID:this.$MqttConnection12,errorCode:t.errorCode,errorMessage:t.errorMessage,duration:Date.now()-this.$MqttConnection9}),this.$MqttConnection2.debugTrace('connect','connection lost'),this.$MqttConnection17.onConnectionLost(),this.$MqttConnection39()},o.$MqttConnection33=function(t){},o.$MqttConnection35=function(t,n){i(d[0]).incr('web.mqtt.protocol.onmessagearrived'),this.$MqttConnection2.debugTrace('onMessageArrived',"Message received on "+t),this.$MqttConnection17.onMessage(t);try{this.$MqttConnection16(t,n)}catch(t){this.$MqttConnection2.logError(t,'Listener threw error'),i(d[0]).incr('web.mqtt.listener_error')}},o.$MqttConnection36=function(t,n){i(d[0]).incr('web.mqtt.protocol.onmessagedelivered');var o=null!=n?n:'null';if(this.$MqttConnection2.debugTrace('onMessageDelivered',"Delivered Message {ID: "+o+"}"),null!=n){var c=this.$MqttConnection5.get(n);null!=c&&(this.$MqttConnection5.delete(n),c.resolve())}},o.$MqttConnection23=function(t){this.$MqttConnection5.forEach(function(n,o,c){n.reject(new Error(t))}),this.$MqttConnection5.clear()},n})();m.exports=n},3604501,[13500510,3604496,3604500,3604502,3604503,3604504,3604505]);
__d(function(g,r,i,a,m,e,d){'use strict';var o=(function(){function o(){this.$MqttConnectionHookCollection1=new Set}var n=o.prototype;return n.addHook=function(o){this.$MqttConnectionHookCollection1.add(o)},n.removeHook=function(o){this.$MqttConnectionHookCollection1.delete(o)},n.onConnectAttempt=function(){this.$MqttConnectionHookCollection1.forEach(function(o){o.onConnectAttempt()})},n.onConnectFailure=function(){this.$MqttConnectionHookCollection1.forEach(function(o){o.onConnectFailure()})},n.onConnected=function(){this.$MqttConnectionHookCollection1.forEach(function(o){o.onConnected()})},n.onConnectSuccess=function(){this.$MqttConnectionHookCollection1.forEach(function(o){o.onConnectSuccess()})},n.onConnectionLost=function(){this.$MqttConnectionHookCollection1.forEach(function(o){o.onConnectionLost()})},n.onSubscribe=function(o){this.$MqttConnectionHookCollection1.forEach(function(n){n.onSubscribe(o)})},n.onUnsubscribe=function(o){this.$MqttConnectionHookCollection1.forEach(function(n){n.onUnsubscribe(o)})},n.onPublish=function(o){this.$MqttConnectionHookCollection1.forEach(function(n){n.onPublish(o)})},n.onMessage=function(o){this.$MqttConnectionHookCollection1.forEach(function(n){n.onMessage(o)})},n.onWSFatal=function(){this.$MqttConnectionHookCollection1.forEach(function(o){o.onWSFatal()})},o})();m.exports=o},3604502,[]);
__d(function(g,r,i,a,m,e,d){'use strict';var n={endpointWithSessionId:function(n,t){return r(d[0]).Env.genGk(r(d[0]).MqttGkNames.mqtt_ep_with_sid)?this.endpointWithExtraParameter(n,'sid',t.toString()):n},endpointWithExtraParameters:function(n,t){var o=this,u=n;return t.forEach(function(n,t,s){u=o.endpointWithExtraParameter(u,t,n)}),u},endpointWithExtraParameter:function(n,t,o){return n.indexOf('?')>0?n+"&"+t+"="+o:n+"?"+t+"="+o},generateSessionId:function(){return Math.floor(r(d[0]).Env.random()*Number.MAX_SAFE_INTEGER)},promiseDone:function(n,t,o){(arguments.length>1?n.then(t,o):n).then(null,function(n){r(d[0]).Env.setTimeout(function(){throw n instanceof Error?n:new Error('promiseDone')},0)})},sprintf:function(n){for(var t=arguments.length,o=new Array(t>1?t-1:0),u=1;u<t;u++)o[u-1]=arguments[u];var s=0;return n.replace(/%s/g,function(){return String(o[s++])})},hasWSSupport:function(){return'WebSocket'in g&&null!==g.WebSocket}};m.exports=n},3604503,[3604496]);
__d(function(g,r,i,a,m,e,d){'use strict';var t={SOCKET_ERROR:new(r(d[0]).MqttError)(1,'Socket error'),SOCKET_MESSAGE:new(r(d[0]).MqttError)(2,'Unable to parse invalid socket message'),INVALID_DATA_TYPE:new(r(d[0]).MqttError)(3,'Received non-arraybuffer from socket.'),CONNECT_TIMEOUT:new(r(d[0]).MqttError)(4,'Connect timed out'),CONNACK_FAILURE:new(r(d[0]).MqttError)(5,'Connection failure due to connack'),PING_TIMEOUT:new(r(d[0]).MqttError)(6,'Ping timeout'),APP_DISCONNECT:new(r(d[0]).MqttError)(7,'Disconnect initiated by app'),SERVER_DISCONNECT:new(r(d[0]).MqttError)(8,'Disconnect message sent my server'),SOCKET_CLOSE:new(r(d[0]).MqttError)(9,'Socket connection closed')},o=(function(){function o(o){var n=this;this.handleMessage=function(o){switch(o.messageType){case r(d[1]).MESSAGE_TYPE.CONNACK:if(null!=n.$MqttProtocolClient7&&(r(d[2]).Env.clearTimeout(n.$MqttProtocolClient7),n.$MqttProtocolClient7=null),o instanceof r(d[1]).WireMessage.ConnAck){var l=o;if(0!==l.returnCode)return n.$MqttProtocolClient6.bumpCounter('protocol.error.connack.invalidreturncode'),n.setConnected(!1),void n.$MqttProtocolClient8(t.CONNACK_FAILURE,l.returnCode);r(d[2]).Env.scheduleCallback(function(){n.$MqttProtocolClient2.onConnectSuccess()}),null!=n.$MqttProtocolClient12&&n.$MqttProtocolClient12.reset()}break;case r(d[1]).MESSAGE_TYPE.PUBLISH:if(o instanceof r(d[1]).WireMessage.Publish){var c=o;r(d[2]).Env.scheduleCallback(function(){n.$MqttProtocolClient2.onMessageArrived(c.topic,c.payloadMessage.payloadString)});var s=c.messageIdentifier;if(n.$MqttProtocolClient6.bumpCounter('protocol.publish.received'),1===c.qos&&null!=s){var C=new(r(d[1]).WireMessage.PubAckUnsubAck)('PUBACK',s);n.$MqttProtocolClient10(C)}}break;case r(d[1]).MESSAGE_TYPE.PUBACK:if(o instanceof r(d[1]).WireMessage.PubAckUnsubAck){var u=o.messageIdentifier;n.$MqttProtocolClient6.bumpCounter('protocol.puback.received'),r(d[2]).Env.scheduleCallback(function(){n.$MqttProtocolClient2.onMessageDelivered('',u)})}break;case r(d[1]).MESSAGE_TYPE.PINGRESP:null!=n.$MqttProtocolClient12&&n.$MqttProtocolClient12.reset();break;case r(d[1]).MESSAGE_TYPE.DISCONNECT:n.$MqttProtocolClient8(t.SERVER_DISCONNECT);break;case r(d[1]).MESSAGE_TYPE.SUBACK:n.$MqttProtocolClient6.bumpCounter('protocol.suback.received');break;case r(d[1]).MESSAGE_TYPE.UNSUBACK:n.$MqttProtocolClient6.bumpCounter('protocol.unsuback.received');break;default:n.$MqttProtocolClient6.logError(new Error('MqttProtocolClient: Received unhandled message type: '+o.messageType),'Received unhandled message type'),n.$MqttProtocolClient6.bumpCounter('protocol.error.handlemessage.unsupportedtype')}},this.$MqttProtocolClient1=o,this.$MqttProtocolClient2={userName:'',mqttVersion:3,keepAliveInterval:10,ignoreSubProtocol:!1,onConnectSuccess:function(){},onConnectFailure:function(t){},onConnection:function(){},onConnectionError:function(t){},onConnectionLost:function(t){},onMessageArrived:function(t,o){},onMessageDelivered:function(t,o){}},this.$MqttProtocolClient3='mqttwsclient',this.$MqttProtocolClient4=0,this.$MqttProtocolClient5=!1,this.$MqttProtocolClient6=r(d[2]).Env.getLoggerInstance()}var n=o.prototype;return n.connect=function(o){var n=this;if(this.$MqttProtocolClient5)throw new Error('Invalid state: connect - already connected');this.$MqttProtocolClient2=o,this.setConnected(!1),null!=this.$MqttProtocolClient7&&(r(d[2]).Env.clearTimeout(this.$MqttProtocolClient7),this.$MqttProtocolClient7=null),this.$MqttProtocolClient7=r(d[2]).Env.setTimeout(function(){n.$MqttProtocolClient6.bumpCounter('protocol.error.connect.timeout'),n.$MqttProtocolClient8(t.CONNECT_TIMEOUT)},3e4),this.$MqttProtocolClient9=r(d[2]).Env.createSocket(this.$MqttProtocolClient1),this.$MqttProtocolClient9.binaryType='arraybuffer',this.$MqttProtocolClient9.onopen=function(){n.setConnected(!0),n.$MqttProtocolClient10(new(r(d[1]).WireMessage.Connect)(n.$MqttProtocolClient3,o)),o.onConnection()},this.$MqttProtocolClient9.onmessage=function(o){var l=o.data;if(!(l instanceof ArrayBuffer))return n.$MqttProtocolClient6.bumpCounter('protocol.error.onmessage.type'),void n.$MqttProtocolClient8(t.INVALID_DATA_TYPE);try{var c=new Uint8Array(l);null!=n.$MqttProtocolClient11&&(c=r(d[3]).concatBuffers(n.$MqttProtocolClient11,c),n.$MqttProtocolClient6.bumpCounter('protocol.debug.usingMessagesBuffer'),delete n.$MqttProtocolClient11,n.$MqttProtocolClient11=null);var s=r(d[1]).decodeByteMessages(c),C=s.messages;n.$MqttProtocolClient11=s.remaining;for(var u=0;u<C.length;u++)n.handleMessage(C[u])}catch(o){n.$MqttProtocolClient11=null,n.$MqttProtocolClient6.logError(o,t.SOCKET_MESSAGE.errorMessage),n.$MqttProtocolClient6.bumpCounter('protocol.error.onmessage.parse'),n.$MqttProtocolClient8(t.SOCKET_MESSAGE)}},this.$MqttProtocolClient9.onerror=function(o){n.$MqttProtocolClient6.bumpCounter('protocol.error.socket'),n.$MqttProtocolClient8(t.SOCKET_ERROR)},this.$MqttProtocolClient9.onclose=function(o){n.$MqttProtocolClient6.bumpCounter('protocol.socket.close'),n.$MqttProtocolClient8(t.SOCKET_CLOSE)},null!=this.$MqttProtocolClient12&&this.$MqttProtocolClient12.cancel(),this.$MqttProtocolClient12=new(r(d[3]).Pinger)(o.keepAliveInterval,this.$MqttProtocolClient10.bind(this,new(r(d[1]).WireMessage.Ping)('PINGREQ')),this.$MqttProtocolClient8.bind(this,t.PING_TIMEOUT))},n.$MqttProtocolClient13=function(){this.setConnected(!1),null!=this.$MqttProtocolClient12&&this.$MqttProtocolClient12.cancel(),null!=this.$MqttProtocolClient7&&(r(d[2]).Env.clearTimeout(this.$MqttProtocolClient7),this.$MqttProtocolClient7=null),null!=this.$MqttProtocolClient9&&(this.$MqttProtocolClient9.onopen=function(t){},this.$MqttProtocolClient9.onmessage=function(t){},this.$MqttProtocolClient9.onerror=function(t){},this.$MqttProtocolClient9.onclose=function(t){},this.$MqttProtocolClient9.readyState===this.$MqttProtocolClient9.OPEN&&this.$MqttProtocolClient9.close(),delete this.$MqttProtocolClient9,this.$MqttProtocolClient9=null),this.$MqttProtocolClient2.onConnectSuccess=function(){},this.$MqttProtocolClient2.onConnectFailure=function(t){},this.$MqttProtocolClient2.onConnection=function(){},this.$MqttProtocolClient2.onConnectionError=function(t){},this.$MqttProtocolClient2.onConnectionLost=function(t){},this.$MqttProtocolClient2.onMessageArrived=function(t,o){},this.$MqttProtocolClient2.onMessageDelivered=function(t,o){}},n.disconnect=function(){null!=this.$MqttProtocolClient9&&this.$MqttProtocolClient9.readyState===this.$MqttProtocolClient9.OPEN&&this.$MqttProtocolClient5?(this.$MqttProtocolClient10(new(r(d[1]).WireMessage.Disconnect)),this.$MqttProtocolClient6.bumpCounter('protocol.debug.disconnect'),this.$MqttProtocolClient8(t.APP_DISCONNECT)):this.$MqttProtocolClient13()},n.isConnected=function(){return this.$MqttProtocolClient5},n.setConnected=function(t){this.$MqttProtocolClient5=t},n.subscribe=function(t){if(!this.$MqttProtocolClient5)throw this.$MqttProtocolClient6.bumpCounter('protocol.error.subscribe.notconnected'),new Error('Invalid state: subscribe - not connected');this.$MqttProtocolClient6.bumpCounter('protocol.subscribe.'+t);var o=new(r(d[1]).WireMessage.Subscription)('SUBSCRIBE',t,0,this.$MqttProtocolClient14());this.$MqttProtocolClient10(o)},n.unsubscribe=function(t){if(!this.$MqttProtocolClient5)throw this.$MqttProtocolClient6.bumpCounter('protocol.error.unsubscribe.notconnected'),new Error('Invalid state: unsubscribe - not connected');this.$MqttProtocolClient6.bumpCounter('protocol.unsubscribe.'+t);var o=new(r(d[1]).WireMessage.Subscription)('UNSUBSCRIBE',t,0,this.$MqttProtocolClient14());this.$MqttProtocolClient10(o)},n.publish=function(t,o,n){this.$MqttProtocolClient5||this.$MqttProtocolClient6.bumpCounter('protocol.error.publish.notconnected'),this.$MqttProtocolClient6.bumpCounter('protocol.publish.'+t);var l=this.$MqttProtocolClient14(),c=new(r(d[1]).WireMessage.Publish)(t,r(d[1]).createMessageWithString(o),n,l);return this.$MqttProtocolClient10(c),l},n.$MqttProtocolClient14=function(){return 6e4==++this.$MqttProtocolClient4&&(this.$MqttProtocolClient4=1),this.$MqttProtocolClient4},n.$MqttProtocolClient8=function(t,o){var n=this.$MqttProtocolClient5,l=this.$MqttProtocolClient2,c=l.onConnectionLost,s=l.onConnectFailure;this.setConnected(!1),n?r(d[2]).Env.scheduleCallback(function(){c(t)}):r(d[2]).Env.scheduleCallback(function(){s(new(r(d[0]).ConnectFailure)(t,null!=o?o:-1))}),this.$MqttProtocolClient13()},n.$MqttProtocolClient10=function(t){var o=this.$MqttProtocolClient9;null!=o&&o.readyState===o.OPEN&&o.send(t.encode())},o})();m.exports=o},3604504,[3604505,3604506,3604496,3604507]);
__d(function(g,r,i,a,m,e,d){'use strict';var t=(function(t){function n(n,o,s){var c;return void 0===s&&(s=null),c=t.call(this,o)||this,c.isRecoverable=n,c.originalError=s,c}return r(d[0])(n,t),n})(r(d[1])(Error));m.exports={MqttError:function(t,n){this.errorCode=t,this.errorMessage=n},MqttChannelError:t,ConnectFailure:function(t,n){this.mqttError=t,this.connAck=n}}},3604505,[13500500,13500520]);
__d(function(g,r,i,a,m,e,d){function t(t,s){var o=s,c=o,y=t[o],p=y>>4;o+=1;var B=r(d[0]).decodeMultiByteInt(t,o);if(null==B)return{wireMessage:null,position:c};var U=(o=B.offset)+B.value;if(U>t.length)return{wireMessage:null,position:c};var w;switch(p){case n.CONNACK:var S=!!(1&t[o++]),A=t[o++];w=new l(S,A);break;case n.PUBLISH:var C=15&y,T=C>>1&3,E=r(d[0]).readUInt16BE(t,o);o+=2;var N=r(d[0]).convertUTF8ToString(t,o,E);o+=E;var P=null;1===T&&(P=r(d[0]).readUInt16BE(t,o),o+=2);var b=v.createWithBytes(t.subarray(o,U));w=new I(N,b,T,P,1==(1&C),8==(8&C));break;case n.PINGREQ:w=new u('PINGREQ');break;case n.PINGRESP:w=new u('PINGRESP');break;case n.PUBACK:case n.UNSUBACK:var M=r(d[0]).readUInt16BE(t,o);w=new f(p===n.PUBACK?'PUBACK':'UNSUBACK',M);break;case n.SUBACK:var K=r(d[0]).readUInt16BE(t,o);o+=2;var O=t.subarray(o,U);w=new h(K,O);break;default:throw new Error(r(d[1]).sprintf('Invalid MQTT message type %s.',p))}return{wireMessage:w,position:U}}var n=Object.freeze({CONNECT:1,CONNACK:2,PUBLISH:3,PUBACK:4,SUBSCRIBE:8,SUBACK:9,UNSUBSCRIBE:10,UNSUBACK:11,PINGREQ:12,PINGRESP:13,DISCONNECT:14}),s=[0,6,77,81,73,115,100,112,3],o=(function(){"use strict";function t(t){this.messageType=n[t]}return t.prototype.encode=function(){throw new TypeError('Cannot abstract class WireMessage')},t})(),u=(function(t){"use strict";function n(n){return t.call(this,n)||this}r(d[2])(n,t);return n.prototype.encode=function(){var t=new ArrayBuffer(2);return new Uint8Array(t)[0]=(15&this.messageType)<<4,t},n})(o),c=(function(t){"use strict";function n(){return t.call(this,'DISCONNECT')||this}r(d[2])(n,t);return n.prototype.encode=function(){var t=(15&this.messageType)<<4,n=new ArrayBuffer(2),s=new Uint8Array(n);return s[0]=t,s.set(r(d[0]).encodeMultiByteInt(0),1),n},n})(o),h=(function(t){"use strict";function n(n,s){var o;return o=t.call(this,'SUBACK')||this,o.messageIdentifier=n,o.returnCode=s,o}return r(d[2])(n,t),n})(o),l=(function(t){"use strict";function n(n,s){var o;return o=t.call(this,'CONNACK')||this,o.sessionPresent=n,o.returnCode=s,o}return r(d[2])(n,t),n})(o),f=(function(t){"use strict";function n(n,s){var o;return o=t.call(this,n)||this,o.messageIdentifier=s,o}r(d[2])(n,t);return n.prototype.encode=function(){var t=(15&this.messageType)<<4,n=r(d[0]).encodeMultiByteInt(2),s=n.length+1,o=new ArrayBuffer(2+s),u=new Uint8Array(o);return u[0]=t,u.set(n,1),s=r(d[0]).writeUInt16BE(this.messageIdentifier,u,s),o},n})(o),y=(function(t){"use strict";function n(n,s){var o;return o=t.call(this,'CONNECT')||this,o.clientId=n,o.connectOptions=s,o}r(d[2])(n,t);return n.prototype.encode=function(){var t=(15&this.messageType)<<4,n=s.length+3;n+=r(d[0]).UTF8Length(this.clientId)+2,n+=r(d[0]).UTF8Length(this.connectOptions.userName)+2;var o=r(d[0]).encodeMultiByteInt(n),u=new ArrayBuffer(1+o.length+n),c=new Uint8Array(u);c[0]=t;var h=1;c.set(o,1),h+=o.length,c.set(s,h),h+=s.length;return c[h++]=130,h=r(d[0]).writeUInt16BE(this.connectOptions.keepAliveInterval,c,h),h=r(d[0]).writeString(this.clientId,r(d[0]).UTF8Length(this.clientId),c,h),h=r(d[0]).writeString(this.connectOptions.userName,r(d[0]).UTF8Length(this.connectOptions.userName),c,h),u},n})(o),p=(function(t){"use strict";function s(n,s,o,u){var c;if(c=t.call(this,n)||this,c.topic=s,o<0&&o>1||1===o&&null==u)throw new TypeError(r(d[1]).sprintf('Argument Invalid. qos: %s messageType: %s.',o,n));return c.qos=o,c.messageIdentifier=u,c}r(d[2])(s,t);return s.prototype.encode=function(){var t=(15&this.messageType)<<4;t|=2;var s=r(d[0]).UTF8Length(this.topic),o=2+s+2;this.messageType===n.SUBSCRIBE&&(o+=1);var u=r(d[0]).encodeMultiByteInt(o),c=new ArrayBuffer(1+u.length+o),h=new Uint8Array(c);h[0]=t;var l=1;return h.set(u,1),l+=u.length,null!=this.messageIdentifier&&(l=r(d[0]).writeUInt16BE(this.messageIdentifier,h,l)),l=r(d[0]).writeString(this.topic,s,h,l),this.messageType===n.SUBSCRIBE&&null!=this.qos&&(h[l++]=this.qos),c},s})(o),v=(function(){"use strict";function t(t,n){this.payloadString=t,this.payloadBytes=n}t.createWithString=function(n){var s=new Uint8Array(new ArrayBuffer(r(d[0]).UTF8Length(n)));return r(d[0]).convertStringToUTF8(n,s,0),new t(n,s)},t.createWithBytes=function(n){for(var s=0,o=n.length;s<n.length&&123!==n[s]&&91!==n[s];)s++,o--;return new t(r(d[0]).convertUTF8ToString(n,s,o),n.subarray(s,o))};var n=t.prototype;return n.string=function(){return this.payloadString},n.bytes=function(){return this.payloadBytes},t})(),I=(function(t){"use strict";function n(n,s,o,u,c,h){var l;if(l=t.call(this,'PUBLISH')||this,l.topic=n,l.payloadMessage=s,l.qos=o,l.messageIdentifier=u,l.retained=null!=c&&c,l.duplicate=null!=h&&h,1===l.qos&&null==l.messageIdentifier)throw new TypeError('Argument Invalid. messageIdentifier: null and qos: 1');return l}r(d[2])(n,t);return n.prototype.encode=function(){var t=(15&this.messageType)<<4;this.duplicate&&(t|=8),t=t|=this.qos<<1,this.retained&&(t|=1);var n=r(d[0]).UTF8Length(this.topic),s=n+2;s+=null==this.messageIdentifier?0:2;var o=this.payloadMessage.bytes();s+=o.byteLength;var u=r(d[0]).encodeMultiByteInt(s),c=new ArrayBuffer(1+u.length+s),h=new Uint8Array(c);h[0]=t,h.set(u,1);var l=1+u.length;return l=r(d[0]).writeString(this.topic,n,h,l),null!=this.messageIdentifier&&(l=r(d[0]).writeUInt16BE(this.messageIdentifier,h,l)),h.set(o,l),c},n})(o);m.exports={MESSAGE_TYPE:n,WireMessage:{Base:o,PubAckUnsubAck:f,Ping:u,ConnAck:l,Connect:y,Disconnect:c,Subscription:p,Publish:I},createMessageWithString:v.createWithString,decodeMessage:t,decodeByteMessages:function(n){for(var s=[],o=0;o<n.length;){var u=t(n,o),c=u.wireMessage;if(o=u.position,!c)break;s.push(c)}var h=null;return o<n.length&&(h=n.subarray(o)),{messages:s,remaining:h}}}},3604506,[3604507,3604503,13500500]);
__d(function(g,r,i,a,m,e,d){function n(n,t,o){var u=o;return t[u++]=n>>8,t[u++]=n%256,u}function t(n,t,o){for(var u=o,h=0,f=n.length;h<f;h++){var s=n.charCodeAt(h);s<128?t[u++]=s:s<2048?(t[u++]=192|s>>6,t[u++]=128|63&s):s<55296||s>=57344?(t[u++]=224|s>>12,t[u++]=128|s>>6&63,t[u++]=128|63&s):(s=65536+((1023&s)<<10|1023&n.charCodeAt(++h)),t[u++]=240|s>>18,t[u++]=128|s>>12&63,t[u++]=128|s>>6&63,t[u++]=128|63&s)}}var o=(function(){"use strict";function n(n,t,o){this.$Pinger1=1e3*n,this.$Pinger2=t,this.$Pinger3=o,this.$Pinger4=!1}var t=n.prototype;return t.$Pinger5=function(){var n=this;this.$Pinger4?(this.$Pinger4=!1,this.$Pinger2(),this.$Pinger6=r(d[0]).Env.setTimeout(function(){n.$Pinger5()},this.$Pinger1)):this.$Pinger3()},t.reset=function(){var n=this;this.$Pinger4=!0,this.$Pinger6&&(r(d[0]).Env.clearTimeout(this.$Pinger6),this.$Pinger6=null),this.$Pinger1>0&&(this.$Pinger6=r(d[0]).Env.setTimeout(function(){n.$Pinger5()},this.$Pinger1))},t.cancel=function(){this.$Pinger6&&(r(d[0]).Env.clearTimeout(this.$Pinger6),this.$Pinger6=null)},n})();m.exports={UTF8Length:function(n){for(var t=0,o=0,u=n.length;o<u;o++){var h=n.charCodeAt(o);h<128?t+=1:h<2048?t+=2:h>=55296&&h<=56319?(t+=4,o++):t+=3}return t},convertStringToUTF8:t,concatBuffers:function(n,t){if(null==n)return t;var o=new Uint8Array(n.length+t.length);return o.set(n),o.set(t,n.length),o},decodeMultiByteInt:function(n,t){var o,u=t,h=0,f=1;do{if(u===n.length)return null;h+=(127&(o=n[u++]))*f,f*=128}while(0!=(128&o));return{value:h,offset:u}},convertUTF8ToString:function(n,t,o){for(var u=[],h=t,f=0;h<t+o;){var s=n[h++];if(s<128)u[f++]=String.fromCharCode(s);else if(s>191&&s<224){var c=n[h++];u[f++]=String.fromCharCode((31&s)<<6|63&c)}else if(s>239&&s<365){var v=((7&s)<<18|(63&n[h++])<<12|(63&n[h++])<<6|63&n[h++])-65536;u[f++]=String.fromCharCode(55296+(v>>10)),u[f++]=String.fromCharCode(56320+(1023&v))}else{var l=n[h++],P=n[h++];u[f++]=String.fromCharCode((15&s)<<12|(63&l)<<6|63&P)}}return u.join('')},encodeMultiByteInt:function(n){for(var t=n,o=new Array(1),u=0;u<4;u++){var h=t%128;if(!((t>>=7)>0)){o[u]=h;break}o[u]=128|h}return o},writeUInt16BE:n,readUInt16BE:function(n,t){return 256*n[t]+n[t+1]},writeString:function(o,u,h,f){var s=n(u,h,f);return t(o,h,s),s+u},Pinger:o}},3604507,[3604496]);
__d(function(g,r,i,a,m,e,d){'use strict';var t=(function(){function t(){this.$MqttAnalyticsHook1=i(d[0]).Env.getLoggerInstance(),this.$MqttAnalyticsHook2=0,this.$MqttAnalyticsHook3=0,this.$MqttAnalyticsHook4=0,this.$MqttAnalyticsHook5=0,i(d[1]).incr('web.mqtt.session_start'),i(d[0]).Env.isUserLoggedInNow()||i(d[1]).incr('web.mqtt.session_start.logout')}var n=t.prototype;return n.onConnectAttempt=function(){i(d[1]).incr('web.mqtt.ws_connect_attempt')},n.onConnectFailure=function(){this.$MqttAnalyticsHook3++,i(d[1]).incr('web.mqtt.ws_connect_failure')},n.onConnected=function(){i(d[1]).incr('web.mqtt.ws_connect_connected')},n.onConnectSuccess=function(){0===this.$MqttAnalyticsHook2&&i(d[1]).incr('web.mqtt.ws_connect_first_success'),this.$MqttAnalyticsHook2++,i(d[1]).incr('web.mqtt.ws_connect_success')},n.onConnectionLost=function(){i(d[1]).incr('web.mqtt.ws_disconnect')},n.onSubscribe=function(t){},n.onUnsubscribe=function(t){},n.onPublish=function(t){i(d[1]).incr('web.mqtt.ws_publish')},n.onMessage=function(t){i(d[1]).incr('web.mqtt.message_arrived')},n.onWSFatal=function(){i(d[1]).incr('web.mqtt.ws_fatal')},n.onPollRequestSent=function(){i(d[1]).incr('web.mqtt.polling_request_send')},n.onPollRequestSuccess=function(){i(d[1]).incr('web.mqtt.polling_request_succeed'),0===this.$MqttAnalyticsHook4&&i(d[1]).incr('web.mqtt.polling_first_success'),this.$MqttAnalyticsHook4++},n.onPollResponse=function(t){i(d[1]).incr('web.mqtt.lp.message_arrived')},n.onPollFinish=function(){},n.onPollRequestFailed=function(t){i(d[1]).incr('web.mqtt.polling_request_failed'),this.$MqttAnalyticsHook5++},t})();m.exports=t},3604508,[3604496,13500510]);
__d(function(g,r,i,a,m,e,d){'use strict';var s=(function(){function s(s){if(this.$IrisSubscribeChecker1=r(d[0]).Env.getLoggerInstance(),this.$IrisSubscribeChecker2=null,this.$IrisSubscribeChecker3=!1,this.$IrisSubscribeChecker4=!1,this.$IrisSubscribeChecker5=!1,this.$IrisSubscribeChecker6=!0,this.$IrisSubscribeChecker7=0,this.$IrisSubscribeChecker8=s,'undefined'!=typeof window){var c=window.location.hostname;'m.facebook.com'!==c&&'mobile.facebook.com'!==c&&'mtouch.facebook.com'!==c||(this.$IrisSubscribeChecker6=!1)}r(d[0]).Env.genGk(r(d[0]).MqttGkNames.messenger_uses_mqtt_rollout)||(this.$IrisSubscribeChecker6=!1)}var c=s.prototype;return c.start=function(){this.$IrisSubscribeChecker6=!0},c.stop=function(){this.$IrisSubscribeChecker6=!1,this.$IrisSubscribeChecker9()},c.onConnectAttempt=function(){},c.onConnectFailure=function(){this.$IrisSubscribeChecker9()},c.onConnected=function(){var s=this;this.$IrisSubscribeChecker7++,this.$IrisSubscribeChecker9(),this.$IrisSubscribeChecker3=!1,this.$IrisSubscribeChecker4=!1,this.$IrisSubscribeChecker5=!1,this.$IrisSubscribeChecker6&&(this.$IrisSubscribeChecker2=r(d[0]).Env.setTimeout(function(){s.$IrisSubscribeChecker10()},8e3))},c.onConnectSuccess=function(){},c.onConnectionLost=function(){this.$IrisSubscribeChecker9()},c.onSubscribe=function(s){'/t_ms'===s&&(this.$IrisSubscribeChecker3=!0)},c.onUnsubscribe=function(s){},c.onPublish=function(s){'/messenger_sync_get_diffs'!==s&&'/messenger_sync_create_queue'!==s||(this.$IrisSubscribeChecker4=!0,this.$IrisSubscribeChecker3&&(this.$IrisSubscribeChecker5=!0,this.$IrisSubscribeChecker9()))},c.onMessage=function(s){},c.onWSFatal=function(){},c.$IrisSubscribeChecker9=function(){this.$IrisSubscribeChecker2&&(r(d[0]).Env.clearTimeout(this.$IrisSubscribeChecker2),this.$IrisSubscribeChecker2=null)},c.$IrisSubscribeChecker10=function(){if(!1===this.$IrisSubscribeChecker4){var s=1===this.$IrisSubscribeChecker7?'no_iris_session_initialConnect':'no_iris_session';this.$IrisSubscribeChecker1.bumpCounter(s),this.$IrisSubscribeChecker1.eventLogMiscellaneousError({errorMessage:s}),this.$IrisSubscribeChecker8()?this.$IrisSubscribeChecker1.bumpCounter(s+'.withProvider'):this.$IrisSubscribeChecker1.bumpCounter(s+'.withoutProvider'),!0===this.$IrisSubscribeChecker3?this.$IrisSubscribeChecker1.bumpCounter(s+'.withTopicSubscribe'):this.$IrisSubscribeChecker1.bumpCounter(s+'.withoutTopicSubscribe')}!1===this.$IrisSubscribeChecker3&&this.$IrisSubscribeChecker1.bumpCounter('no_iris_topic_subscribe'),!0===this.$IrisSubscribeChecker3&&!0===this.$IrisSubscribeChecker4&&!1===this.$IrisSubscribeChecker5&&this.$IrisSubscribeChecker1.bumpCounter('session_before_topic_subscribe')},s})();m.exports=s},3604509,[3604496]);
__d(function(g,r,i,a,m,e,d){"use strict";Object.defineProperty(e,'__esModule',{value:!0});e.default=function(t){this.eventHandler=t}},3604510,[]);